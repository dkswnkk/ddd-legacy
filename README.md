# 키친포스

## 퀵 스타트

```sh
cd docker
docker compose -p kitchenpos up -d
```

## 요구 사항

### 상품(product)

- [ ] 각 상품은 **상품명**과 **가격**을 필수로 가진다.
    - 상품의 가격은 null 이거나 음수일 수 없다.
    - 상품명은 null 이거나 욕설을 포함할 수 없다. 욕설의 포함 여부는 외부 API로 검증한다.

### 메뉴(menu)

- [ ] 각 메뉴는 **메뉴명, 가격**, 그리고 **노출 여부**을 필수로 가진다.
    - 각 메뉴의 가격은 null 이거나 음수일 수 없다.
    - 매뉴명은 null 이거나 욕설을 포함할 수 없다. 욕설의 포함 여부는 외부 API로 검증한다.
    - 메뉴의 가격은 메뉴에 포함된 하위 모든 상품의(수량 * 가격)합과 일치해야 한다.
    - 메뉴 등록, 가격 변경 그리고 노출로 메뉴 변경 시, 요청 가격은 위의 합과 일치해야 한다.
- [ ] 각 메뉴는 소속된 **메뉴 그룹의 ID**를 참조한다.

### 메뉴 그룹(menu_group)

- [ ] 각 메뉴 그룹은 **메뉴 그룹명**을 필수로 가진다.
    - 메뉴 그룹명은 null이거나 빈 문자열일 수 없다.

### 메뉴 상품(menu_product)

- [ ] 메뉴 상품은 **상품 ID**와 **메뉴 ID**를 필수로 가진다.
- [ ] 각 메뉴 상품은 **수량** 정보를 포함한다.

### 주문(orders)

- [ ] 주문은 선택적으로 **배달 주소**를 가질 수 있다.
- [ ] 각 주문은 **주문 시간**을 기록한다.
- [ ] 각 주문은 현재의 **진행 상태**를 나타낸다.
    - 진행 상태는 `WAITING, ACCEPTED, SERVED, DELIVERING, DELIVERED, COMPLETED` 중 하나이다.
- [ ] 주문은 **주문 방법**을 가진다.
    - 주문 방법은 `DELIVERY, TAKEOUT, EAT_IN` 중 하나이다.
- [ ] 주문은 선택적으로 **주문 테이블의 ID**를 가질 수 있다.

  #### 주문 생성
    - 주문 생성 시 **주문 방법**이 지정되어 있어야 한다.
    - 주문에는 최소 하나 이상의 **메뉴 항목**이 포함되어 있어야 한다.
    - 각 메뉴 항목은 **메뉴가 노출 상태**이어야 하며, 메뉴 가격이 주문 라인 아이템 가격과 일치해야 한다.
    - **배달 주소**는 배달 주문(Delivery) 시 필수이다.
    - 매장 내 식사(EAT_IN)의 경우, 해당 **주문 테이블이 사용 중**이어야 한다.

  #### 주문 수락
    - 주문은 `WAITING` 상태에서만 수락할 수 있다.
    - 배달 주문은 배달 요청이 가능해야 하며, 주문 금액과 배달 주소가 필요하다.
    - 주문 배달의 경우 라이더를 외부 API를 사용해서 호출한다.

  #### 제공
    - 주문은 `ACCEPTED` 상태에서만 제공할 수 있다.
    - 주문 상태를 `SERVED`로 변경한다.

  #### 배달 시작
    - 배달 주문은 `SERVED` 상태와 주문 방법이 `DELIVERY`일 경우에만 배달을 시작할 수 있다.
    - 주문 상태를 `DELIVERING`으로 변경한다.

  #### 배달 완료
    - 주문은 `DELIVERING` 상태에서만 배달 완료로 처리할 수 있다.
    - 주문 상태를 `DELIVERED`로 변경한다.

  #### 주문 완료
    - 배달 주문은 `DELIVERED` 상태에서만 주문 완료로 처리할 수 있다.
    - 테이크아웃 또는 매장 내 식사는 `SERVED` 상태에서만 주문 완료로 처리할 수 있다.
    - 매장 내 식사의 경우 주문이 완료되면 관련 주문 테이블의 손님 수를 0으로 설정하고 사용 상태를 비활성화한다.
    - 주문 상태를 `COMPLETED`로 변경한다.

### 주문 테이블(order_table)

- [ ] 각 주문 테이블은 **테이블의 이름**을 필수로 가진다.
    - 테이블의 이름은 null이거나 빈 문자열일 수 없다.
- [ ] 각 테이블은 **현재 테이블의 사용 여부**를 나타내는 **상태값**을 필수로 가진다.
    - 테이블은 처음에는 사용 중이지 않은 상태(false)로 생성된다.
    - 손님이 앉으면 상태가 true로 변경된다.
- [ ] 각 테이블은 **앉아 있는 손님 수**를 필수로 기록한다.
    - 초기에는 0명으로 설정된다.
    - 손님 수는 0명 이상이어야 하며, 테이블이 비어있을 때(false)는 수정할 수 없다.

### 주문 라인 아이템(order_line_item)

- [ ] 각 주문 라인 아이템은 **메뉴 ID**와 연결되어 어떤 메뉴가 주문되었는지를 식별한다.
- [ ] 각 주문 라인 아이템은 **주문 ID**를 참조하여 해당 주문 라인이 속한 주문을 식별한다.

## 용어 사전

### 도메인 모델 용어

| 한글명       | 영문명             | 설명                                                 |
|-----------|-----------------|----------------------------------------------------|
| 상품        | Product         | 판매할 아이템을 나타내며, 가격과 이름을 필수로 가진다.                    |
| 메뉴        | Menu            | 고객이 선택할 수 있는 음식 목록으로, 하나 이상의 상품으로 구성된다.            |
| 메뉴 그룹     | Menu Group      | 비슷한 종류의 메뉴들을 묶어 그룹화하는 카테고리.                        |
| 메뉴 상품     | Menu Product    | 메뉴를 구성하는 개별 상품과 그 상품의 수량을 나타낸다.                    |
| 주문        | Order           | 고객이 요청한 메뉴의 집합으로, 주문 방법과 주문 시간, 주문 상태를 포함한다.       |
| 주문 테이블    | Order Table     | 식당에서 손님이 사용하는 테이블로, 이름과 사용 여부, 앉아 있는 손님 수를 기록한다.   |
| 주문 라인 아이템 | Order Line Item | 특정 주문에 포함된 개별 메뉴 아이템을 나타내며, 수량과 함께 관련 메뉴 ID를 참조한다. |

### 주문 상태(OrderStatus)

| 값          | 설명                        |
|------------|---------------------------|
| WAITING    | 주문이 접수되었으나 아직 처리되지 않은 상태. |
| ACCEPTED   | 주문이 확인되어 준비가 시작된 상태.      |
| SERVED     | 주문이 준비되어 제공된 상태.          |
| DELIVERING | 주문이 배달 중인 상태.             |
| DELIVERED  | 주문이 고객에게 배달된 상태.          |
| COMPLETED  | 주문이 완료된 상태.               |

### 주문 방법(OrderType)

| 값        | 설명                    |
|----------|-----------------------|
| DELIVERY | 주문이 배달로 처리되는 경우.      |
| TAKEOUT  | 주문이 테이크아웃으로 처리되는 경우.  |
| EAT_IN   | 주문이 매장 내 식사로 처리되는 경우. |

## 모델링
<img width="453" alt="image" src="https://github.com/dkswnkk/ddd-legacy/assets/74492426/f150d536-e9ea-4a01-aa33-9394339cd51f">

